<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏´‡∏ß‡∏¢ Simulator</title>

<style>
body{background:#f7d3f2;font-family:'Sarabun',sans-serif;padding:20px;}
.box{max-width:500px;margin:auto;background:#fff;padding:20px;border-radius:15px;box-shadow:0 5px 20px rgba(0,0,0,0.15);}
h2{text-align:center;color:#c449d5;margin-bottom:20px;font-weight:900;}
.mode-row{display:flex;gap:10px;margin-bottom:15px;}
.mode-btn{background:#ffe9a8;border:none;padding:10px 18px;border-radius:8px;cursor:pointer;font-weight:bold;}
.mode-btn.active{background:#ffb700;color:#fff;}
input[type=text],input[type=number]{width:100%;padding:12px;border-radius:10px;border:1px solid #aaa;font-size:16px;}
.numbers-container{min-height:50px;padding:10px;border-radius:10px;border:1px solid #ddd;background:#fffafc;display:flex;flex-wrap:wrap;gap:6px;margin-top:5px;}
.num-pill{background:#1e6bff;color:#fff;padding:6px 10px;border-radius:8px;font-size:15px;font-weight:bold;border:none;cursor:pointer;}
.row{display:flex;gap:10px;margin:10px 0;}
.btn-rev{background:#ffe06c;padding:12px 16px;border-radius:10px;font-weight:bold;}
.btn-clear{background:#ffb3c1;padding:12px 16px;border-radius:10px;font-weight:bold;}
.btn-add{background:#ff44c7;color:white;padding:12px 16px;border-radius:10px;font-weight:bold;}
.bill-box{margin-top:20px;background:#ffe7f8;padding:15px;border-radius:15px;}
.bill{background:white;padding:15px;border-radius:12px;margin-bottom:15px;display:flex;justify-content:space-between;border:1px solid #ddd;}
.bill-left{width:85%;font-size:16px;}
.bill-title{font-weight:bold;margin-bottom:5px;}
.bill-price{font-weight:bold;margin-bottom:5px;}
.bill-line{white-space:nowrap;margin-bottom:4px;}
.bill-total{font-weight:bold;color:#d7006a;}
.del-btn{font-size:22px;color:red;cursor:pointer;}
.total-all{text-align:center;font-size:22px;margin-top:20px;font-weight:bold;}
</style>
</head>

<body>

<div class="box">
    <h2>‡∏´‡∏ß‡∏¢ Simulator</h2>

    <div class="mode-row">
        <button class="mode-btn active" id="btn2d" onclick="switchMode('2d')">2 ‡∏ï‡∏±‡∏ß</button>
        <button class="mode-btn" id="btn3d" onclick="switchMode('3d')">3 ‡∏ï‡∏±‡∏ß</button>
        <button class="mode-btn" id="btn19" onclick="switchMode('19')">‡∏£‡∏π‡∏î 19</button>
        <button class="mode-btn" id="btnRun" onclick="switchMode('run')">‡∏ß‡∏¥‡πà‡∏á</button>
    </div>

    <div id="zoneMain">
        <div class="label">‡∏ä‡πà‡∏≠‡∏á 1 (2/3 ‡∏ï‡∏±‡∏ß)</div>
        <input id="inputMain" type="text">
    </div>

    <div id="zoneRood" style="display:none;">
        <div class="label">‡∏£‡∏π‡∏î: ‡∏û‡∏¥‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß</div>
        <input id="inputRood" type="text" autocomplete="off">
    </div>

    <div id="zoneRun" style="display:none;">
        <div class="label">‡∏ß‡∏¥‡πà‡∏á: ‡∏û‡∏¥‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß</div>
        <input id="inputRun" type="text" autocomplete="off">
    </div>

    <div class="label">‡∏ä‡πà‡∏≠‡∏á 2: ‡πÄ‡∏•‡∏Ç‡∏•‡πâ‡∏ß‡∏ô</div>
    <div id="numbersContainer" class="numbers-container"></div>

    <div class="row">
        <button class="btn-rev" onclick="reverseNumbers()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏•‡∏Ç</button>
        <button class="btn-clear" onclick="clearNumbersAndBills()">‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç</button>
    </div>

    <div class="row">
        <input id="top" type="number" placeholder="‡∏ö‡∏ô">
        <input id="bottom" type="number" placeholder="‡∏•‡πà‡∏≤‡∏á">
        <input id="tod" type="number" placeholder="‡πÇ‡∏ï‡πä‡∏î" style="display:none;">
    </div>

    <button class="btn-add" onclick="addBillAndReset()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏¥‡∏•</button>

    <div class="bill-box" id="billList"></div>
    <div id="totalAll" class="total-all">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 ‡∏ö‡∏≤‡∏ó</div>
</div>

<script>
/* ========================= ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å ========================= */
let bills=[], currentNums=[];
let mode="2d", buffer="", lastDigits="", isPaste=false;

const inputMain=document.getElementById("inputMain");
const inputRun=document.getElementById("inputRun");
const inputRood=document.getElementById("inputRood");
const top=document.getElementById("top");
const bottom=document.getElementById("bottom");
const tod=document.getElementById("tod");
const nc=document.getElementById("numbersContainer");

const p2=n=>n.toString().padStart(2,"0");
const p3=n=>n.toString().padStart(3,"0");

/* ========================= ‡πÇ‡∏´‡∏°‡∏î ========================= */
function switchMode(m){
    mode=m;
    document.querySelectorAll(".mode-btn").forEach(x=>x.classList.remove("active"));
    document.getElementById("btn2d").classList.toggle("active",m==="2d");
    document.getElementById("btn3d").classList.toggle("active",m==="3d");
    document.getElementById("btn19").classList.toggle("active",m==="19");
    document.getElementById("btnRun").classList.toggle("active",m==="run");

    document.getElementById("zoneMain").style.display=(m==="2d"||m==="3d")?"block":"none";
    document.getElementById("zoneRood").style.display=m==="19"?"block":"none";
    document.getElementById("zoneRun").style.display=m==="run"?"block":"none";

    tod.style.display = m==="3d" ? "block" : "none";

    currentNums=[]; renderNumbers();
    inputMain.value=""; inputRun.value=""; inputRood.value="";
    top.value=""; bottom.value=""; tod.value="";
}

/* ========================= render pill ========================= */
function renderNumbers(){
    nc.innerHTML="";
    currentNums.forEach((o,i)=>{
        let b=document.createElement("button");
        b.className="num-pill"; b.textContent=o.val;
        b.onclick=()=>{ currentNums.splice(i,1); renderNumbers(); };
        nc.appendChild(b);
    });
}

/* ========================= input 2/3 ‡∏ï‡∏±‡∏ß ========================= */
inputMain.addEventListener("input",e=>{
    if(mode!=="2d"&&mode!=="3d")return;
    let d=e.target.value.replace(/\D/g,"");
    e.target.value="";

    if(mode==="2d" && d.length>=2){
        currentNums.push({val:p2(d.slice(0,2))});
    }
    if(mode==="3d" && d.length>=3){
        currentNums.push({val:p3(d.slice(0,3))});
    }
    renderNumbers();
});

/* ========================= ‡∏ß‡∏¥‡πà‡∏á ========================= */
inputRun.addEventListener("input",e=>{
    if(mode!=="run")return;
    let d=e.target.value.replace(/\D/g,"");
    if(d){ currentNums.push({val:d[0]}); }
    e.target.value=""; renderNumbers();
});

/* ========================= ‡∏£‡∏π‡∏î 19 ========================= */
function gen19(d){
    let a=[];
    for(let i=0;i<=9;i++) a.push(p2(i+""+d));
    for(let i=0;i<=9;i++) a.push(p2(d+""+i));
    return a;
}

inputRood.addEventListener("input",e=>{
    if(mode!=="19")return;
    let d=e.target.value.replace(/\D/g,"")[0];
    e.target.value="";
    if(!d)return;

    currentNums = gen19(d).map(n=>({val:n}));
    renderNumbers();
});

/* ========================= reverse ========================= */
function reverseNumbers(){
    if(mode==="19"||mode==="run")return;
    let add=[];
    currentNums.forEach(o=>{
        let n=o.val;
        if(n.length===2){
            let r=p2(n[1]+n[0]);
            if(r!==n && !currentNums.some(x=>x.val===r)) add.push({val:r});
        }
        if(n.length===3){
            let [a,b,c]=n;
            let arr=[a+b+c,a+c+b,b+a+c,b+c+a,c+a+b,c+b+a];
            [...new Set(arr)].forEach(r=>{
                if(!currentNums.some(x=>x.val===r)) add.push({val:r});
            });
        }
    });
    currentNums=currentNums.concat(add);
    renderNumbers();
}

/* ========================= ‡∏•‡πâ‡∏≤‡∏á ========================= */
function clearNumbers(){ currentNums=[]; renderNumbers(); }
function clearNumbersAndBills(){ clearNumbers(); bills=[]; renderBills(); }

/* ========================= ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏¥‡∏• ========================= */
function addBill(){
    if(currentNums.length===0)return;

    let topv=Number(top.value||0);
    let botv=Number(bottom.value||0);
    let todv=Number(tod.value||0);

    let total=0;
    if(mode==="3d"){ botv=0; total=currentNums.length*(topv+todv); }
    else total=currentNums.length*(topv+botv);

    bills.push({
        nums:currentNums.map(x=>x.val),
        top:topv,bottom:botv,tod:todv,
        total:total,mode:mode
    });

    renderBills();
    clearNumbers();
    top.value=""; bottom.value=""; tod.value="";
}

/* ========================= render Bills ========================= */
function renderBills(){
    let out="",sum=0;
    bills.forEach((b,i)=>{
        sum+=b.total;
        let title = b.mode==="2d"?"2 ‡∏ï‡∏±‡∏ß": b.mode==="3d"?"3 ‡∏ï‡∏±‡∏ß": b.mode==="19"?"‡∏£‡∏π‡∏î 19":"‡∏ß‡∏¥‡πà‡∏á";
        let price = b.mode==="3d" ? `${b.top} √ó 0 √ó ${b.tod}` : `${b.top} √ó ${b.bottom}`;
        let line=b.nums.join(" ");
        out+=`
        <div class="bill">
            <div class="bill-left">
                <div class="bill-title">${title}</div>
                <div class="bill-price">${price}</div>
                <div class="bill-line">${line}</div>
                <div class="bill-total">‡∏£‡∏ß‡∏°‡∏ö‡∏¥‡∏•: ${b.total} ‡∏ö‡∏≤‡∏ó</div>
            </div>
            <div class="del-btn" onclick="bills.splice(${i},1);renderBills();">üóë</div>
        </div>`;
    });
    document.getElementById("billList").innerHTML=out;
    document.getElementById("totalAll").textContent=`‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${sum} ‡∏ö‡∏≤‡∏ó`;
}

/* ========================= TAB ========================= */
document.addEventListener("keydown",e=>{
    if(e.key!=="Tab")return;
    e.preventDefault();

    if([inputMain,inputRun,inputRood].includes(document.activeElement)){ top.focus(); return; }
    if(document.activeElement===top){
        if(mode==="3d") tod.focus();
        else bottom.focus();
        return;
    }
    if(document.activeElement===bottom || document.activeElement===tod){
        addBill(); 
        if(mode==="2d"||mode==="3d") inputMain.focus();
        if(mode==="run") inputRun.focus();
        if(mode==="19") inputRood.focus();
    }
});

/* ========================= SPACE = reverse ========================= */
document.addEventListener("keydown",e=>{
    if(e.code==="Space"){ e.preventDefault(); reverseNumbers(); }
});
</script>

</body>
</html>
