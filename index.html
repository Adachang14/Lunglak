<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏´‡∏ß‡∏¢ Simulator Demo</title>

<style>
    body {
        background:#f7d3f2;
        font-family:'Sarabun', sans-serif;
        padding:20px;
    }
    .box {
        width:100%;
        max-width:500px;
        margin:auto;
        background:#fff;
        padding:20px;
        border-radius:15px;
        box-shadow:0 5px 20px rgba(0,0,0,0.15);
    }
    h2 {
        text-align:center;
        color:#c449d5;
        margin-bottom:20px;
        font-weight:900;
    }

    .mode-row {
        display:flex;
        gap:10px;
        margin-bottom:15px;
    }
    .mode-btn {
        background:#ffe9a8;
        border:none;
        padding:10px 18px;
        border-radius:8px;
        cursor:pointer;
        font-weight:bold;
    }
    .mode-btn.active {
        background:#ffb700;
        color:white;
    }

    input[type="text"] {
        width:100%;
        padding:12px;
        border-radius:10px;
        border:1px solid:#aaa;
        font-size:16px;
    }

    .numbers-container {
        min-height:50px;
        padding:10px;
        border-radius:10px;
        border:1px solid:#ddd;
        background:#fffafc;
        display:flex;
        flex-wrap:wrap;
        gap:6px;
        margin-top:4px;
    }

    .num-pill {
        background:#1e6bff;
        color:#fff;
        padding:6px 10px;
        border-radius:8px;
        font-size:15px;
        font-weight:bold;
        border:none;
        cursor:pointer;
    }

    .row {
        display:flex;
        gap:10px;
        margin:10px 0;
    }

    input[type="number"] {
        width:100%;
        padding:12px;
        border-radius:10px;
        border:1px solid:#ccc;
        font-size:16px;
    }

    .btn-rev { background:#ffe06c; padding:12px 16px; border-radius:10px; font-weight:bold; cursor:pointer; }
    .btn-clear{ background:#ffb3c1; padding:12px 16px; border-radius:10px; font-weight:bold; cursor:pointer; }
    .btn-add  { background:#ff44c7; color:white; padding:12px 16px; border-radius:10px; font-weight:bold; cursor:pointer; }

    .bill-box {
        margin-top:20px;
        background:#ffe7f8;
        padding:15px;
        border-radius:15px;
    }

    .bill {
        background:white;
        padding:15px;
        border-radius:12px;
        margin-bottom:15px;
        display:flex;
        justify-content:space-between;
        border:1px solid:#ddd;
    }

    .bill-title { font-weight:bold; margin-bottom:5px; }
    .bill-price { font-weight:bold; color:#333; margin-bottom:5px; }
    .bill-total { font-weight:bold; color:#d7006a; }
    .del-btn { font-size:22px; color:red; cursor:pointer; user-select:none; }
    .total-all { text-align:center; font-size:22px; margin-top:20px; font-weight:bold; }

    .win-grid {
        display:grid;
        grid-template-columns: repeat(5, 1fr);
        gap:8px;
        margin-top:10px;
    }
    .win-btn {
        background:#ffe9a8;
        padding:15px 0;
        border-radius:10px;
        font-size:20px;
        font-weight:bold;
        text-align:center;
        cursor:pointer;
        border:2px solid #f6c56e;
    }
    .win-btn.active {
        background:#ffb700;
        color:white;
        border-color:#ff9800;
    }
</style>
</head>

<body>
<div class="box">

<h2>‡∏´‡∏ß‡∏¢ Simulator Demo</h2>

<div class="mode-row">
    <button class="mode-btn active" id="btn2d" onclick="switchMode('2d')">2 ‡∏ï‡∏±‡∏ß</button>
    <button class="mode-btn" id="btn3d" onclick="switchMode('3d')">3 ‡∏ï‡∏±‡∏ß</button>
    <button class="mode-btn" id="btn19" onclick="switchMode('19')">‡∏£‡∏π‡∏î 19</button>
    <button class="mode-btn" id="btnRun" onclick="switchMode('run')">‡∏ß‡∏¥‡πà‡∏á</button>
    <button class="mode-btn" id="btnWin" onclick="switchMode('win')">‡∏ß‡∏¥‡∏ô</button>
</div>

<div id="zoneMain">
    <div class="label">‡∏ä‡πà‡∏≠‡∏á 1 (2/3 ‡∏ï‡∏±‡∏ß)</div>
    <input id="inputMain" type="text">
</div>

<div id="zoneRood" style="display:none;">
    <div class="label">‡∏£‡∏π‡∏î: ‡∏û‡∏¥‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡∏ß‡∏≤‡∏á)</div>
    <input id="inputRood" type="text">
</div>

<div id="zoneRun" style="display:none;">
    <div class="label">‡∏ß‡∏¥‡πà‡∏á: ‡∏û‡∏¥‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡∏ß‡∏≤‡∏á)</div>
    <input id="inputRun" type="text">
</div>

<div id="zoneWin" style="display:none; margin-top:20px;">
    <div style="margin-bottom:10px;">
        <label><input type="radio" name="winMode" value="2" checked> ‡∏à‡∏±‡∏ö‡∏ß‡∏¥‡∏ô 2 ‡∏ï‡∏±‡∏ß</label>
        <label><input type="radio" name="winMode" value="3"> ‡∏à‡∏±‡∏ö‡∏ß‡∏¥‡∏ô 3 ‡∏ï‡∏±‡∏ß</label>
    </div>

    <div style="margin-bottom:15px;">
        <label><input type="radio" name="winDup" value="no" checked> ‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡πâ‡∏•</label>
        <label><input type="radio" name="winDup" value="yes"> ‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡πâ‡∏•</label>
    </div>

    <div style="font-weight:bold; margin-bottom:10px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ß‡∏¥‡∏ô 2‚Äì7 ‡∏ï‡∏±‡∏ß</div>

    <div id="winDigits" class="win-grid"></div>

    <div style="display:flex; gap:10px; margin-top:15px;">
        <button class="btn-add" onclick="winCalculate()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
        <button class="btn-rev" onclick="winReverse()">‡∏Å‡∏•‡∏±‡∏ö‡∏ß‡∏¥‡∏ô</button>
        <button class="btn-clear" onclick="winClear()" style="background:#ff4c4c;color:white;">üóë ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
</div>

<div class="label">‡∏ä‡πà‡∏≠‡∏á 2: ‡πÄ‡∏•‡∏Ç‡∏•‡πâ‡∏ß‡∏ô</div>
<div id="numbersContainer" class="numbers-container"></div>

<div class="row" style="margin-top:15px;">
    <button class="btn-rev" onclick="reverseNumbers()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏•‡∏Ç</button>
    <button class="btn-clear" onclick="clearNumbersAndBills()">‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç</button>
</div>

<div class="row">
    <input id="top" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ö‡∏ô">
    <input id="bottom" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏•‡πà‡∏≤‡∏á">
    <input id="tod" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÇ‡∏ï‡πä‡∏î" style="display:none;">
</div>

<button class="btn-add" onclick="addBillAndReset()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏¥‡∏•</button>

<div class="bill-box" id="billList"></div>
<div id="totalAll" class="total-all">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 ‡∏ö‡∏≤‡∏ó</div>

</div> <!-- END .box -->

<script>

/* ==================== ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å ==================== */
let bills = [];
let currentNums = [];
let winSelected = [];

let mode = "2d";
let buffer = "";
let lastDigits = "";
let isPaste = false;

const inputMain  = document.getElementById("inputMain");
const inputRun   = document.getElementById("inputRun");
const inputRood  = document.getElementById("inputRood");

const numbersContainer = document.getElementById("numbersContainer");
const topPrice   = document.getElementById("top");
const bottomPrice= document.getElementById("bottom");
const todPrice   = document.getElementById("tod");

const pad2 = n => n.toString().padStart(2,"0");
const pad3 = n => n.toString().padStart(3,"0");

/* ==================== ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏´‡∏°‡∏î ==================== */
function baseSwitchMode(m){
    mode = m;

    document.querySelectorAll(".mode-btn").forEach(x=>x.classList.remove("active"));
    document.getElementById("btn2d").classList.toggle("active", m==="2d");
    document.getElementById("btn3d").classList.toggle("active", m==="3d");
    document.getElementById("btn19").classList.toggle("active", m==="19");
    document.getElementById("btnRun").classList.toggle("active", m==="run");
    document.getElementById("btnWin").classList.toggle("active", m==="win");

    document.getElementById("zoneMain").style.display = (m==="2d"||m==="3d")?"block":"none";
    document.getElementById("zoneRood").style.display = m==="19"?"block":"none";
    document.getElementById("zoneRun").style.display  = m==="run"?"block":"none";
    document.getElementById("zoneWin").style.display  = "none";

    todPrice.style.display = m==="3d" ? "block" : "none";

    inputMain.value="";
    inputRun.value="";
    inputRood.value="";
    topPrice.value="";
    bottomPrice.value="";
    todPrice.value="";

    buffer="";
    lastDigits="";
    currentNums=[];
    renderNumbers();

    if(m==="2d"||m==="3d") inputMain.focus();
    if(m==="run") inputRun.focus();
    if(m==="19") inputRood.focus();
}

function switchMode(m){
    baseSwitchMode(m);

    if(m==="win"){
        document.getElementById("zoneWin").style.display="block";
        initWinButtons();
    }
}

/* ==================== ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç pill ==================== */
function renderNumbers(){
    numbersContainer.innerHTML="";
    currentNums.forEach((obj,idx)=>{
        let b=document.createElement("button");
        b.className="num-pill";
        b.textContent=obj.val;
        b.onclick=()=>{ currentNums.splice(idx,1); renderNumbers(); };
        numbersContainer.appendChild(b);
    });
}

/* ==================== input 2/3 ‡∏ï‡∏±‡∏ß ==================== */
inputMain.addEventListener("paste",()=> isPaste=true);

inputMain.addEventListener("input",(e)=>{

    if(mode!=="2d" && mode!=="3d") return;

    let digits = e.target.value.replace(/\D/g,"");

    if(isPaste){
        handlePaste(e.target.value);
        isPaste=false;
        setTimeout(()=> inputMain.value="",150);
        buffer=""; lastDigits="";
        return;
    }

    if(digits.length<lastDigits.length){
        buffer=""; lastDigits=digits;
        return;
    }

    buffer += digits.slice(lastDigits.length);
    lastDigits = digits;

    if(mode==="2d"){
        while(buffer.length>=2){
            currentNums.push({val:pad2(buffer.slice(0,2))});
            buffer=""; inputMain.value=""; lastDigits="";
        }
    }

    if(mode==="3d"){
        while(buffer.length>=3){
            currentNums.push({val:pad3(buffer.slice(0,3))});
            buffer=""; inputMain.value=""; lastDigits="";
        }
    }

    renderNumbers();
});

function handlePaste(text){
    let clean=text.replace(/[^0-9\s]/g," ");
    clean.split(/\s+/).filter(x=>x).forEach(n=>{
        if(mode==="2d" && n.length===2) currentNums.push({val:pad2(n)});
        if(mode==="3d" && n.length===3) currentNums.push({val:pad3(n)});
    });
    renderNumbers();
}

/* ==================== ‡∏ß‡∏¥‡πà‡∏á ==================== */
inputRun.addEventListener("paste",e=> e.preventDefault());

inputRun.addEventListener("input",(e)=>{
    if(mode!=="run") return;
    let d=e.target.value.replace(/\D/g,"");
    if(!d) return;
    currentNums.push({val:d[0]});
    inputRun.value="";
    renderNumbers();
});

/* ==================== ‡∏£‡∏π‡∏î 19 ==================== */
function generate19(d){
    let out=[];
    for(let i=0;i<=9;i++) out.push(pad2(i+d));
    for(let i=0;i<=9;i++) out.push(pad2(d+i));
    return out;
}

inputRood.addEventListener("paste",e=> e.preventDefault());
inputRood.addEventListener("input",(e)=>{
    if(mode!=="19") return;
    let d=e.target.value.replace(/\D/g,"")[0];
    inputRood.value="";
    if(!d) return;

    generate19(d).forEach(n=>{
        if(!currentNums.some(x=>x.val===n)) currentNums.push({val:n});
    });

    renderNumbers();
});

/* ==================== reverse 2/3 ‡∏ï‡∏±‡∏ß ==================== */
function reverseNumbers(){
    if(mode==="run"||mode==="19"||mode==="win") return;

    let add=[];
    currentNums.forEach(o=>{
        let n=o.val;

        if(n.length===2){
            if(n[0]!==n[1]){
                let r=n[1]+n[0];
                if(!currentNums.some(x=>x.val===r)) add.push({val:r});
            }
        }

        if(n.length===3){
            let a=n[0], b=n[1], c=n[2];
            let arr=[a+b+c, a+c+b, b+a+c, b+c+a, c+a+b, c+b+a];
            [...new Set(arr)].forEach(r=>{
                if(!currentNums.some(x=>x.val===r)) add.push({val:r});
            });
        }
    });

    currentNums=currentNums.concat(add);
    renderNumbers();
}

/* ==================== ‡∏ß‡∏¥‡∏ô‡πÄ‡∏•‡∏Ç ==================== */
function initWinButtons(){
    winSelected=[];
    const zone=document.getElementById("winDigits");
    zone.innerHTML="";

    function addBtn(n){
        let b=document.createElement("div");
        b.className="win-btn";
        b.textContent=n;

        b.onclick=()=>{
            if(b.classList.contains("active")){
                b.classList.remove("active");
                winSelected=winSelected.filter(x=>x!==String(n));
            }else{
                if(winSelected.length>=7) return;
                b.classList.add("active");
                winSelected.push(String(n));
            }
        };

        zone.appendChild(b);
    }

    for(let i=1;i<=9;i++) addBtn(i);
    addBtn(0);
}

/* ==================== ‡∏ß‡∏¥‡∏ô ‚Äî ‡πÑ‡∏°‡πà‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏≠‡∏á ==================== */
function winCalculate(){
    if(winSelected.length < 2){
        alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏ï‡∏±‡∏ß");
        return;
    }

    let type=document.querySelector("input[name='winMode']:checked").value;
    let dup=document.querySelector("input[name='winDup']:checked").value==="yes";
    let out=[];

    if(type==="2"){
        for(let i=0;i<winSelected.length;i++){
            for(let j=0;j<winSelected.length;j++){

                if(dup){
                    if(i <= j) out.push(winSelected[i]+winSelected[j]);
                }else{
                    if(i < j) out.push(winSelected[i]+winSelected[j]);
                }

            }
        }
    }

    if(type==="3"){
        for(let i=0;i<winSelected.length;i++){
            for(let j=0;j<winSelected.length;j++){
                for(let k=0;k<winSelected.length;k++){

                    if(dup){
                        if(i <= j && j <= k)
                            out.push(winSelected[i]+winSelected[j]+winSelected[k]);
                    }else{
                        if(i < j && j < k)
                            out.push(winSelected[i]+winSelected[j]+winSelected[k]);
                    }

                }
            }
        }
    }

    currentNums=out.map(v=>({val:v}));
    renderNumbers();
}

/* ==================== ‡∏Å‡∏•‡∏±‡∏ö‡∏ß‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢ ==================== */
function winReverse(){
    let add=[];

    currentNums.forEach(o=>{
        let v=o.val;

        if(v.length===2){
            let r=v[1]+v[0];
            if(r!==v &&
               !currentNums.some(x=>x.val===r) &&
               !add.some(x=>x.val===r)){
                add.push({val:r});
            }
        }

        if(v.length===3){
            let a=v[0], b=v[1], c=v[2];
            let combos=[
                c+b+a,
                b+c+a,
                c+a+b,
                b+a+c,
                a+c+b
            ];
            combos.forEach(r=>{
                if(r!==v &&
                   !currentNums.some(x=>x.val===r) &&
                   !add.some(x=>x.val===r)){
                    add.push({val:r});
                }
            });
        }
    });

    currentNums=currentNums.concat(add);
    renderNumbers();
}

function winClear(){
    winSelected=[];
    document.querySelectorAll(".win-btn").forEach(b=>b.classList.remove("active"));
    currentNums=[];
    renderNumbers();
}

/* ==================== ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏¥‡∏• ==================== */
function addBill(){
    let list=currentNums.map(x=>x.val);
    if(list.length===0) return false;

    let t=Number(topPrice.value||0);
    let b=Number(bottomPrice.value||0);
    let td=Number(todPrice.value||0);

    let total=0;

    if(mode==="2d"||mode==="run"||mode==="19"||mode==="win")
        total=list.length*(t+b);

    if(mode==="3d"){
        b=0;
        total=list.length*(t+td);
    }

    bills.push({nums:list, top:t, bottom:b, tod:td, total:total, mode:mode});
    renderBills();
    return true;
}

function addBillAndReset(){
    if(!addBill()) return;

    currentNums=[];
    renderNumbers();

    topPrice.value="";
    bottomPrice.value="";
    todPrice.value="";

    if(mode==="2d"||mode==="3d") inputMain.focus();
    if(mode==="run") inputRun.focus();
    if(mode==="19") inputRood.focus();
}

/* ==================== render bills ==================== */
const _canvas=document.createElement("canvas");
const _ctx=_canvas.getContext("2d");
_ctx.font="15px 'Sarabun'";

function groupByWidth(nums,w){
    let lines=[],cur="",width=0;

    nums.forEach(n=>{
        const token=(cur?" ":"")+n;
        const tw=_ctx.measureText(token).width;

        if(width+tw>w){
            lines.push(cur);
            cur=n;
            width=_ctx.measureText(n).width;
        }else{
            cur+=(cur?" ":"")+n;
            width+=tw;
        }
    });

    if(cur) lines.push(cur);
    return lines;
}

function renderBills(){
    let html="",total=0;
    let box=document.getElementById("billList");
    let w=Math.max((box.clientWidth||0)-40,100);

    bills.forEach((b,i)=>{
        total+=b.total;

        let title=
            b.mode==="2d"?"2 ‡∏ï‡∏±‡∏ß":
            b.mode==="3d"?"3 ‡∏ï‡∏±‡∏ß":
            b.mode==="run"?"‡∏ß‡∏¥‡πà‡∏á":
            b.mode==="19"?"‡∏£‡∏π‡∏î 19":"‡∏ß‡∏¥‡∏ô‡πÄ‡∏•‡∏Ç";

        let priceLine=(b.mode==="3d")
            ?`${b.top} √ó 0 √ó ${b.tod}`
            :`${b.top} √ó ${b.bottom}`;

        let lines=groupByWidth(b.nums, b.mode==="3d"?w:w*0.7)
            .map(l=>`<div class="bill-line">${l}</div>`).join("");

        html+=`
        <div class="bill">
            <div>
                <div class="bill-title">${title}</div>
                <div class="bill-price">${priceLine}</div>
                <div>${lines}</div>
                <div class="bill-total">‡∏£‡∏ß‡∏°‡∏ö‡∏¥‡∏•: ${b.total} ‡∏ö‡∏≤‡∏ó</div>
            </div>
            <div class="del-btn" onclick="delBill(${i})">üóë</div>
        </div>`;
    });

    document.getElementById("billList").innerHTML=html;
    document.getElementById("totalAll").textContent=`‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total} ‡∏ö‡∏≤‡∏ó`;
}

function delBill(i){
    bills.splice(i,1);
    renderBills();
}

function clearNumbersAndBills(){
    bills=[];
    currentNums=[];
    renderNumbers();
    renderBills();
}

/* ==================== TAB ==================== */
document.addEventListener("keydown",(e)=>{
    if(e.key!=="Tab") return;
    e.preventDefault();

    let el=document.activeElement;

    if(el===inputMain||el===inputRun||el===inputRood){
        topPrice.focus(); topPrice.select(); return;
    }

    if(el===topPrice){
        if(mode==="3d") todPrice.focus(), todPrice.select();
        else bottomPrice.focus(), bottomPrice.select();
        return;
    }

    if(el===bottomPrice || el===todPrice){
        addBillAndReset();
        return;
    }
});

/* ==================== Space = reverse ==================== */
document.addEventListener("keydown",(e)=>{
    if(e.code==="Space"){
        if(mode==="2d"||mode==="3d"){
            e.preventDefault();
            reverseNumbers();
        }
    }
});

</script>
</body>
</html>
