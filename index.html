<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>หวย Simulator</title>

<style>
    body {
        background:#f7d3f2;
        font-family:'Sarabun', sans-serif;
        padding:20px;
    }
    .box {
        width:100%;
        max-width:550px;
        margin:auto;
        background:#fff;
        padding:20px;
        border-radius:15px;
        box-shadow:0 5px 20px rgba(0,0,0,0.15);
    }
    h2 {
        text-align:center;
        color:#c449d5;
        margin-bottom:20px;
    }

    .mode-row {
        display:flex;
        gap:10px;
        margin-bottom:15px;
    }
    .mode-btn {
        background:#ffe9a8;
        border:none;
        padding:10px 18px;
        border-radius:8px;
        cursor:pointer;
        font-weight:bold;
    }
    .mode-btn.active {
        background:#ffb700;
        color:white;
    }

    input[type="text"] {
        width:100%;
        padding:12px;
        border-radius:10px;
        border:1px solid #aaa;
        font-size:16px;
    }

    .numbers-container {
        min-height:80px;
        padding:10px;
        border-radius:10px;
        border:1px solid #ddd;
        background:#fffafc;
        display:flex;
        flex-wrap:wrap;
        gap:6px;
        margin-top:4px;
    }

    .pill {
        padding:6px 10px;
        border-radius:8px;
        font-size:15px;
        font-weight:bold;
        border:none;
        cursor:pointer;
        color:white;
    }
    .good { background:#1e6bff; }
    .bad  { background:#ff3b3b; }

    .row { display:flex; gap:10px; margin:10px 0; }

    input[type="number"] {
        width:100%;
        padding:12px;
        border-radius:10px;
        border:1px solid #ccc;
        font-size:16px;
    }

    button {
        padding:12px 16px;
        font-size:16px;
        border-radius:10px;
        border:none;
        cursor:pointer;
        font-weight:bold;
    }

    .btn-rev  { background:#ffe06c; }
    .btn-clear{ background:#ffb3c1; }
    .btn-add  { background:#ff44c7; color:white; }

    .bill-box {
        margin-top:20px;
        background:#ffe7f8;
        padding:15px;
        border-radius:15px;
    }
    .bill {
        background:white;
        padding:15px;
        border-radius:12px;
        margin-bottom:15px;
        display:flex;
        justify-content:space-between;
        border:1px solid #ddd;
    }
    .bill-nums {
        background:#f8f8f8;
        padding:8px;
        border-radius:10px;
        border:1px solid #ddd;
        line-height:1.3;
        font-size:12px;
        white-space:normal;
        word-break:break-word;
    }
    .bill-total {
        font-weight:bold;
        color:#d7006a;
        margin-top:8px;
    }
    .del-btn {
        font-size:22px;
        cursor:pointer;
        color:red;
    }
    .total-all {
        text-align:center;
        margin-top:20px;
        font-size:22px;
        font-weight:bold;
    }
</style>
</head>

<body>

<div class="box">

    <h2>หวย Simulator Demo</h2>

    <div class="mode-row">
        <button class="mode-btn active" id="btn2" onclick="switchMode('2')">2 ตัว</button>
        <button class="mode-btn" id="btn3" onclick="switchMode('3')">3 ตัว</button>
    </div>

    <input id="inputNums" type="text" placeholder="เช่น 12 56 หรือ 640 405">

    <div id="numbersContainer" class="numbers-container"></div>

    <div class="row">
        <button class="btn-rev" onclick="reverseNum()">กลับเลข</button>
        <button class="btn-clear" onclick="clearAll()">ล้างเลข</button>
    </div>

    <div class="row">
        <input id="top" type="number" placeholder="บน">
        <input id="bottom" type="number" placeholder="ล่าง">
    </div>

    <button class="btn-add" onclick="addBillAndReset()">+ เพิ่มบิล</button>

    <div id="billList" class="bill-box"></div>
    <div id="totalAll" class="total-all">รวมทั้งหมด: 0 บาท</div>

</div>

<script>
let mode="2";          // 2 หรือ 3
let good=[];           // เลขถูกต้อง (ฟ้า)
let bad=[];            // เลขผิดปกติ (แดง)
let bills=[];

/* เปลี่ยนโหมด */
function switchMode(m){
    mode=m;
    document.querySelectorAll(".mode-btn").forEach(x=>x.classList.remove("active"));
    document.getElementById("btn"+m).classList.add("active");
    clearAll();
}

/* แสดงเลข */
function render(){
    const box=document.getElementById("numbersContainer");
    box.innerHTML="";

    good.forEach((n,i)=>{
        let b=document.createElement("button");
        b.className="pill good";
        b.textContent=n;
        b.onclick=()=>{ good.splice(i,1); render(); };
        box.appendChild(b);
    });

    bad.forEach((n,i)=>{
        let b=document.createElement("button");
        b.className="pill bad";
        b.textContent=n;
        b.onclick=()=>{ bad.splice(i,1); render(); };
        box.appendChild(b);
    });
}

/* parser อัจฉริยะ */
document.getElementById("inputNums").addEventListener("input",function(){
    let raw=this.value.trim();
    if(raw.length===0) return;

    // ดึงทุกตัวเลขจากข้อความ (รองรับ -, *, /, +, =, ---)
    let found = raw.match(/\d+/g);

    if(found){
        found.forEach(num=>{
            if(mode==="2"){
                if(num.length===2) good.push(num);
                else if(num.length>2){
                    let parts=num.match(/\d{2}/g);
                    if(parts) parts.forEach(p=>good.push(p));
                } else bad.push(num);
            }
            else{
                if(num.length===3) good.push(num);
                else if(num.length>3){
                    let parts=num.match(/\d{3}/g);
                    if(parts) parts.forEach(p=>good.push(p));
                } else bad.push(num);
            }
        });
    }

    this.value="";
    render();
});

/* reverse เฉพาะฟ้า */
function reverseNum(){
    let out=[...good];

    good.forEach(n=>{
        if(mode==="2"){
            let r=n[1]+n[0];
            if(!out.includes(r)) out.push(r);
        } else {
            let a=n[0],b=n[1],c=n[2];
            let list=[a+b+c,a+c+b,b+a+c,b+c+a,c+a+b,c+b+a];
            list=[...new Set(list)];
            list.forEach(p=>{ if(!out.includes(p)) out.push(p); });
        }
    });

    good=out;
    render();
}

/* ล้าง */
function clearAll(){
    good=[];
    bad=[];
    document.getElementById("inputNums").value="";
    document.getElementById("top").value="";
    document.getElementById("bottom").value="";
    render();
}

/* เพิ่มบิล */
function addBill(){
    if(good.length===0) return false;

    let t=Number(document.getElementById("top").value||0);
    let b=Number(document.getElementById("bottom").value||0);
    let total = good.length*(t+b);

    bills.push({
        mode:mode,
        nums:[...good],
        top:t,
        bottom:b,
        total:total
    });

    renderBills();
    return true;
}

function addBillAndReset(){
    if(!addBill()) return;
    clearAll();
}

/* ลบบิล */
function delBill(i){
    bills.splice(i,1);
    renderBills();
}

/* แสดงบิล */
function renderBills(){
    let html="";
    let sum=0;

    bills.forEach((b,i)=>{
        sum+=b.total;

        html+=`
        <div class="bill">
            <div>
                <div><b>${b.mode==="2"?"2 ตัว":"3 ตัว"}</b></div>
                <div>${b.top} × ${b.bottom}</div>
                <div class="bill-nums">${b.nums.join(" ")}</div>
                <div class="bill-total">รวมบิล: ${b.total} บาท</div>
            </div>
            <div class="del-btn" onclick="delBill(${i})">×</div>
        </div>`;
    });

    document.getElementById("billList").innerHTML=html;
    document.getElementById("totalAll").textContent="รวมทั้งหมด: "+sum+" บาท";
}

/* TAB */
document.addEventListener("keydown",function(e){
    if(e.key!=="Tab") return;
    e.preventDefault();
    let top=document.getElementById("top");
    let bottom=document.getElementById("bottom");

    if(document.activeElement===top){ bottom.focus(); bottom.select(); return; }
    if(document.activeElement===bottom){ addBillAndReset(); return; }
    top.focus(); top.select();
});

/* SPACE = กลับเลข */
document.addEventListener("keydown",function(e){
    if(e.code==="Space"){ e.preventDefault(); reverseNum(); }
});
</script>

</body>
</html>
