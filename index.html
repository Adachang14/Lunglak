<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏´‡∏ß‡∏¢ Simulator</title>

<style>
    body {
        background:#f7d3f2;
        font-family:'Sarabun', sans-serif;
        padding:20px;
    }
    .box {
        width:100%;
        max-width:500px;
        margin:auto;
        background:#fff;
        padding:20px;
        border-radius:15px;
        box-shadow:0 5px 20px rgba(0,0,0,0.15);
    }
    h2 {
        text-align:center;
        color:#c449d5;
        margin-bottom:20px;
    }

    .mode-row {
        display:flex;
        gap:10px;
        margin-bottom:15px;
    }
    .mode-btn {
        background:#ffe9a8;
        border:none;
        padding:10px 18px;
        border-radius:8px;
        cursor:pointer;
        font-weight:bold;
    }
    .mode-btn.active {
        background:#ffb700;
        color:white;
    }

    input[type="text"] {
        width:100%;
        padding:12px;
        border-radius:10px;
        border:1px solid #aaa;
        font-size:16px;
        transition:0.2s;
    }
    .highlight {
        box-shadow:0 0 10px #ff44c7;
        border-color:#ff44c7 !important;
    }

    .numbers-container {
        min-height:50px;
        padding:10px;
        border-radius:10px;
        border:1px solid #ddd;
        background:#fffafc;
        display:flex;
        flex-wrap:wrap;
        gap:6px;
        margin-top:4px;
    }
    .num-pill {
        background:#1e6bff;
        color:#fff;
        padding:6px 10px;
        border-radius:8px;
        font-size:15px;
        font-weight:bold;
        border:none;
        cursor:pointer;
    }
    .num-pill.error {
        background:#ff3b3b;
        color:white;
    }

    .row { display:flex; gap:10px; margin:10px 0; }

    input[type="number"] {
        width:100%;
        padding:12px;
        border-radius:10px;
        border:1px solid:#ccc;
        font-size:16px;
    }

    button {
        padding:12px 16px;
        font-size:16px;
        border-radius:10px;
        border:none;
        cursor:pointer;
        font-weight:bold;
    }
    .btn-rev  { background:#ffe06c; }
    .btn-clear{ background:#ffb3c1; }
    .btn-add  { background:#ff44c7; color:white; }

    .bill-box {
        margin-top:20px;
        background:#ffe7f8;
        padding:15px;
        border-radius:15px;
    }

    .bill {
        background:white;
        padding:15px;
        border-radius:12px;
        margin-bottom:15px;
        display:flex;
        justify-content:space-between;
        border:1px solid #ddd;
    }

    .bill-left {
        width:85%;
        font-size:16px;
    }

    .bill-title {
        font-weight:bold;
        font-size:17px;
        margin-bottom:5px;
        color:#333;
    }

    .bill-price {
        color:#777;
        font-size:14px;
    }

    .bill-multiply {
        font-weight:bold;
        margin-bottom:8px;
    }

    .bill-nums {
        background:#f8f8f8;
        padding:10px;
        border-radius:10px;
        border:1px solid #ddd;
        line-height:1.7;
        word-break:break-all;
        font-size:15px;
        margin-bottom:8px;
    }

    .bill-total {
        font-weight:bold;
        color:#d7006a;
    }

    .del-btn {
        font-size:22px;
        color:red;
        cursor:pointer;
        user-select:none;
    }

    .total-all {
        text-align:center;
        font-size:22px;
        margin-top:20px;
        font-weight:bold;
    }

    .label {
        font-size:14px;
        margin:5px 0 3px;
        color:#555;
    }
</style>
</head>

<body>

<div class="box">

    <h2>‡∏´‡∏ß‡∏¢ Simulator Demo</h2>

    <div class="mode-row">
        <button class="mode-btn active" id="btn2d" onclick="switchMode('2d')">2 ‡∏ï‡∏±‡∏ß</button>
        <button class="mode-btn" id="btn3d" onclick="switchMode('3d')">3 ‡∏ï‡∏±‡∏ß</button>
        <button class="mode-btn" id="btn19" onclick="switchMode('19')">19 ‡∏õ‡∏£‡∏∞‡∏ï‡∏π</button>
        <button class="mode-btn" id="btnRun" onclick="switchMode('run')">‡πÄ‡∏•‡∏Ç‡∏ß‡∏¥‡πà‡∏á</button>
    </div>

    <div class="label">‡∏ä‡πà‡∏≠‡∏á 1: ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≠‡∏õ‡πÄ‡∏•‡∏Ç</div>
    <input id="inputNums" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12 25 ‡∏´‡∏£‡∏∑‡∏≠ 123 456">

    <div class="label">‡∏ä‡πà‡∏≠‡∏á 2: ‡πÄ‡∏•‡∏Ç‡∏•‡πâ‡∏ß‡∏ô (‡∏•‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß)</div>
    <div id="numbersContainer" class="numbers-container"></div>

    <div class="row">
        <button class="btn-rev" onclick="reverseNumbers()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏•‡∏Ç</button>
        <button class="btn-clear" onclick="clearNumbers()">‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç</button>
    </div>

    <div class="row">
        <input id="top" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ö‡∏ô">
        <input id="bottom" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏•‡πà‡∏≤‡∏á">
    </div>

    <button id="btnAdd" class="btn-add" onclick="addBillAndReset()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏¥‡∏•</button>

    <div class="bill-box" id="billList"></div>
    <div id="totalAll" class="total-all">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 ‡∏ö‡∏≤‡∏ó</div>

</div>

<script>
let bills = [];
let currentNums = [];
let mode = "2d";

let isPaste = false;
let buffer = "";
let lastInputValue = ""; // ‡πÉ‡∏ä‡πâ‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤

const inputNums = document.getElementById("inputNums");
const numbersContainer = document.getElementById("numbersContainer");
const topPrice = document.getElementById("top");
const bottomPrice = document.getElementById("bottom");

const pad2 = n => n.toString().padStart(2,"0");
const pad3 = n => n.toString().padStart(3,"0");

/* ----------------------- MODE ----------------------- */
function switchMode(m){
    mode = m;

    document.querySelectorAll(".mode-btn").forEach(x=>x.classList.remove("active"));
    document.getElementById("btn2d").classList.toggle("active", m==="2d");
    document.getElementById("btn3d").classList.toggle("active", m==="3d");
    document.getElementById("btn19").classList.toggle("active", m==="19");
    document.getElementById("btnRun").classList.toggle("active", m==="run");

    clearNumbers();

    // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ä‡πà‡∏≠‡∏á 1 ‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏ü‡∏Å‡∏±‡∏™ + ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ß‡∏≤‡∏á / ‡∏û‡∏¥‡∏°‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    inputNums.value = "";
    buffer = "";
    lastInputValue = "";
    inputNums.focus();
    inputNums.select();
    inputNums.classList.add("highlight");
    setTimeout(()=> inputNums.classList.remove("highlight"), 200);
}

/* ----------------------- RENDER ----------------------- */
function renderNumbers(){
    numbersContainer.innerHTML = "";
    currentNums.forEach((obj, idx)=>{
        let btn = document.createElement("button");
        btn.className = obj.error ? "num-pill error" : "num-pill";
        btn.textContent = obj.val;

        btn.onclick = ()=>{
            currentNums.splice(idx,1);
            renderNumbers();
        };

        numbersContainer.appendChild(btn);
    });
}

/* ----------------------- HANDLE PASTE ----------------------- */
function handlePaste(text){
    let clean = text.replace(/[^0-9]/g," ");
    let blocks = clean.split(/\s+/).filter(x=>x.length>0);

    blocks.forEach(block=>{
        if(mode==="2d"){
            while(block.length>=2){
                currentNums.push({val:pad2(block.slice(0,2)), error:false});
                block = block.slice(2);
            }
            if(block.length===1){
                currentNums.push({val:block, error:true});
            }
        }

        if(mode==="3d"){
            while(block.length>=3){
                currentNums.push({val:pad3(block.slice(0,3)), error:false});
                block = block.slice(3);
            }
            if(block.length>0){
                currentNums.push({val:block, error:true});
            }
        }
    });

    renderNumbers();
}

/* ----------------------- HANDLE TYPING ----------------------- */
// ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
function handleTyping(newDigits){
    let created = 0;
    buffer += newDigits;

    if(mode==="2d"){
        while(buffer.length>=2){
            currentNums.push({val:pad2(buffer.slice(0,2)), error:false});
            buffer = buffer.slice(2);
            created++;
        }
    }

    if(mode==="3d"){
        while(buffer.length>=3){
            currentNums.push({val:pad3(buffer.slice(0,3)), error:false});
            buffer = buffer.slice(3);
            created++;
        }
    }

    if(created>0){
        renderNumbers();
    }
    return created;
}

/* ----------------------- INPUT LISTENER + DELAY ----------------------- */
inputNums.addEventListener("paste", ()=>{ isPaste = true; });

inputNums.addEventListener("input",(e)=>{
    let v = e.target.value;

    if(isPaste){
        // ‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡∏•‡∏∞‡∏¢‡∏≤‡∏ß
        handlePaste(v);
        buffer = "";
        isPaste = false;
        lastInputValue = "";
        setTimeout(()=>{ inputNums.value = ""; }, 350);
        return;
    }

    // ‡πÇ‡∏´‡∏°‡∏î‡∏û‡∏¥‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß: ‡∏´‡∏≤ "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤"
    let prev = lastInputValue;
    let prevDigits = prev.replace(/\D/g,"");
    let newDigitsAll = v.replace(/\D/g,"");

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤
    lastInputValue = v;

    // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà <= ‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á ‚Üí ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï buffer ‡∏ó‡∏¥‡πâ‡∏á ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ö‡∏±‡πä‡∏Å
    if(newDigitsAll.length <= prevDigits.length){
        buffer = "";
        return;
    }

    // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    let addedDigits = newDigitsAll.slice(prevDigits.length);

    let created = handleTyping(addedDigits);

    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏ä‡∏∏‡∏î‡∏ñ‡∏π‡∏Å‡∏î‡∏∂‡∏á‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô pill ‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ä‡πà‡∏≠‡∏á 1
    if(created > 0){
        setTimeout(()=>{
            inputNums.value = "";
            lastInputValue = "";
        }, 350);
    }
});

/* ----------------------- REVERSE ----------------------- */
function reverse3digit(num){
    const [a,b,c] = num.split("");
    if(a===b && b===c) return [num];

    let arr = [
        a+b+c, a+c+b,
        b+a+c, b+c+a,
        c+a+b, c+b+a
    ];

    return [...new Set(arr)];
}

function reverseNumbers(){
    let add = [];

    currentNums.forEach(obj=>{
        if(obj.error) return;

        if(mode==="2d"){
            const a = obj.val[0];
            const b = obj.val[1];

            // ‡πÄ‡∏•‡∏Ç‡πÄ‡∏ö‡∏¥‡πâ‡∏• (11,22,...,99) ‡πÑ‡∏°‡πà‡∏Å‡∏•‡∏±‡∏ö
            if(a === b) return;

            const rev = pad2(b + a);

            // ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏Ç‡∏ã‡πâ‡∏≥
            if(!currentNums.some(o => !o.error && o.val === rev)){
                add.push({val:rev, error:false});
            }
        }

        if(mode==="3d"){
            reverse3digit(obj.val).forEach(x=>{
                if(!currentNums.some(o=>o.val===x)){
                    add.push({val:x, error:false});
                }
            });
        }
    });

    currentNums = currentNums.concat(add);
    renderNumbers();
}

/* ----------------------- CLEAR ----------------------- */
function clearNumbers(){
    currentNums = [];
    buffer = "";
    renderNumbers();
    topPrice.value = "";
    bottomPrice.value = "";
}

/* ----------------------- BILL SYSTEM ----------------------- */
function addBill(){
    let valid = currentNums.filter(x=>!x.error).map(x=>x.val);
    if(valid.length===0) return false;

    let t = Number(topPrice.value||0);
    let b = Number(bottomPrice.value||0);

    bills.push({
        nums:valid,
        top:t,
        bottom:b,
        total:valid.length*(t+b),
        mode:mode
    });

    renderBills();
    return true;
}

function addBillAndReset(){
    if(!addBill()) return;
    clearNumbers();
    inputNums.value = "";
    lastInputValue = "";
    buffer = "";
    inputNums.focus();
    inputNums.select();
}

function delBill(index){
    bills.splice(index,1);
    renderBills();
}

function renderBills(){
    let html = "";
    let total = 0;

    bills.forEach((b,i)=>{
        total += b.total;

        html+=`
        <div class="bill">
            <div class="bill-left">
                <div class="bill-title">${b.mode==="3d"?"3 ‡∏ï‡∏±‡∏ß":"2 ‡∏ï‡∏±‡∏ß"}</div>
                <div class="bill-price">${b.mode==="3d"?'‡∏ö‡∏ô √ó ‡∏•‡πà‡∏≤‡∏á √ó ‡πÇ‡∏ï‡πä‡∏î':'‡∏ö‡∏ô √ó ‡∏•‡πà‡∏≤‡∏á'}</div>
                <div class="bill-multiply">${b.top} √ó ${b.bottom}</div>
                <div class="bill-nums">${b.nums.join(" ")}</div>
                <div class="bill-total">‡∏£‡∏ß‡∏°‡∏ö‡∏¥‡∏•: ${b.total} ‡∏ö‡∏≤‡∏ó</div>
            </div>
            <div class="del-btn" onclick="delBill(${i})">üóë</div>
        </div>
        `;
    });

    document.getElementById("billList").innerHTML = html;
    document.getElementById("totalAll").innerText = `‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total} ‡∏ö‡∏≤‡∏ó`;
}

/* ----------------------- NEW TAB CONTROL ----------------------- */
document.addEventListener("keydown", function(e) {
    if (e.key !== "Tab") return;
    e.preventDefault();

    // TAB 1 ‚Äî ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏Ç ‚Üí ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ö‡∏ô
    if (document.activeElement === inputNums) {
        topPrice.focus(); topPrice.select();
        return;
    }

    // TAB 2 ‚Äî ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ö‡∏ô ‚Üí ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏•‡πà‡∏≤‡∏á
    if (document.activeElement === topPrice) {
        bottomPrice.focus(); bottomPrice.select();
        return;
    }

    // TAB 3 ‚Äî ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏•‡πà‡∏≤‡∏á ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏¥‡∏•
    if (document.activeElement === bottomPrice) {
        addBillAndReset();
        return;
    }

    // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 3 ‡∏à‡∏∏‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‚Üí ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏Ç
    inputNums.focus();
    inputNums.select();
});

/* ----------------------- SPACE = REVERSE ----------------------- */
document.addEventListener("keydown",(e)=>{
    if(e.code==="Space"){
        e.preventDefault();
        reverseNumbers();
    }
});
</script>
</body>
</html>
