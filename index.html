<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏´‡∏ß‡∏¢ Simulator Demo</title>

<style>
    body {
        background:#f7d3f2;
        font-family:'Sarabun', sans-serif;
        padding:20px;
    }
    .box {
        width:100%;
        max-width:500px;
        margin:auto;
        background:#fff;
        padding:20px;
        border-radius:15px;
        box-shadow:0 5px 20px rgba(0,0,0,0.15);
    }
    h2 {
        text-align:center;
        color:#c449d5;
        margin-bottom:20px;
    }

    .mode-row {
        display:flex;
        gap:10px;
        margin-bottom:15px;
    }
    .mode-btn {
        background:#ffe9a8;
        border:none;
        padding:10px 18px;
        border-radius:8px;
        cursor:pointer;
        font-weight:bold;
    }
    .mode-btn.active {
        background:#ffb700;
        color:white;
    }

    .input-block { margin-bottom:10px; }

    input[type="text"] {
        width:100%;
        padding:12px;
        border-radius:10px;
        border:1px solid:#aaa;
        font-size:16px;
        transition:0.2s;
    }

    .numbers-container {
        min-height:50px;
        padding:10px;
        border-radius:10px;
        border:1px solid:#ddd;
        background:#fffafc;
        display:flex;
        flex-wrap:wrap;
        gap:6px;
        margin-top:4px;
    }
    .num-pill {
        background:#1e6bff;
        color:#fff;
        padding:6px 10px;
        border-radius:8px;
        font-size:15px;
        font-weight:bold;
        border:none;
        cursor:pointer;
    }
    .num-pill.error {
        background:#ff3b3b;
        color:white;
    }

    .row { display:flex; gap:10px; margin:10px 0; }

    input[type="number"] {
        width:100%;
        padding:12px;
        border-radius:10px;
        border:1px solid:#ccc;
        font-size:16px;
    }

    button {
        padding:12px 16px;
        font-size:16px;
        border-radius:10px;
        border:none;
        cursor:pointer;
        font-weight:bold;
    }
    .btn-rev  { background:#ffe06c; }
    .btn-clear{ background:#ffb3c1; }
    .btn-add  { background:#ff44c7; color:white; }

    .bill-box {
        margin-top:20px;
        background:#ffe7f8;
        padding:15px;
        border-radius:15px;
    }

    .bill {
        background:white;
        padding:15px;
        border-radius:12px;
        margin-bottom:15px;
        display:flex;
        justify-content:space-between;
        border:1px solid:#ddd;
    }

    .bill-left {
        width:85%;
        font-size:16px;
    }

    .bill-title {
        font-weight:bold;
        font-size:17px;
        margin-bottom:5px;
        color:#333;
    }

    .bill-price {
        color:#777;
        font-size:14px;
    }

    .bill-multiply {
        font-weight:bold;
        margin-bottom:8px;
    }

    .bill-nums {
        background:#f8f8f8;
        padding:10px;
        border-radius:10px;
        border:1px solid:#ddd;
        font-size:15px;
        margin-bottom:8px;
        display:block;
        white-space:normal;
        word-break:break-word;
    }

    .bill-line {
        white-space:nowrap;
        margin-bottom:4px;
        display:block;
    }

    .bill-total {
        font-weight:bold;
        color:#d7006a;
    }

    .del-btn {
        font-size:22px;
        color:red;
        cursor:pointer;
        user-select:none;
    }

    .total-all {
        text-align:center;
        font-size:22px;
        margin-top:20px;
        font-weight:bold;
    }

    .label {
        font-size:14px;
        margin:5px 0 3px;
        color:#555;
    }

</style>
</head>

<body>

<div class="box">

    <h2>‡∏´‡∏ß‡∏¢ Simulator Demo</h2>

    <!-- MODE SELECT -->
    <div class="mode-row">
        <button class="mode-btn active" id="btn2d" onclick="switchMode('2d')">2 ‡∏ï‡∏±‡∏ß</button>
        <button class="mode-btn" id="btn3d" onclick="switchMode('3d')">3 ‡∏ï‡∏±‡∏ß</button>
        <button class="mode-btn" id="btn19" onclick="switchMode('19')">‡∏£‡∏π‡∏î 19</button>
        <button class="mode-btn" id="btnRun" onclick="switchMode('run')">‡∏ß‡∏¥‡πà‡∏á</button>
    </div>

    <!-- INPUT ZONE -->

    <!-- 2D / 3D ‡πÉ‡∏ä‡πâ inputMain -->
    <div id="zoneMain">
        <div class="label">‡∏ä‡πà‡∏≠‡∏á 1 (2/3 ‡∏ï‡∏±‡∏ß): ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≠‡∏õ‡πÄ‡∏•‡∏Ç</div>
        <input id="inputMain" type="text">
    </div>

    <!-- RUDE (19 ‡∏õ‡∏£‡∏∞‡∏ï‡∏π) -->
    <div id="zoneRood" style="display:none;">
        <div class="label">‡∏£‡∏π‡∏î: ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡∏ß‡∏≤‡∏á)</div>
        <input id="inputRood" type="text" autocomplete="off">
    </div>

    <!-- RUN -->
    <div id="zoneRun" style="display:none;">
        <div class="label">‡∏ß‡∏¥‡πà‡∏á: ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡∏ß‡∏≤‡∏á)</div>
        <input id="inputRun" type="text" autocomplete="off">
    </div>

    <!-- OUTPUT -->
    <div class="label">‡∏ä‡πà‡∏≠‡∏á 2: ‡πÄ‡∏•‡∏Ç‡∏•‡πâ‡∏ß‡∏ô (‡∏•‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß)</div>
    <div id="numbersContainer" class="numbers-container"></div>

    <div class="row">
        <button class="btn-rev" onclick="reverseNumbers()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏•‡∏Ç</button>
        <button class="btn-clear" onclick="clearNumbersAndBills()">‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç</button>
    </div>

    <div class="row">
        <input id="top" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ö‡∏ô">
        <input id="bottom" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏•‡πà‡∏≤‡∏á">
    </div>

    <button id="btnAdd" class="btn-add" onclick="addBillAndReset()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏¥‡∏•</button>

    <div class="bill-box" id="billList"></div>
    <div id="totalAll" class="total-all">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 ‡∏ö‡∏≤‡∏ó</div>

</div>

<script>
/* ============================================================== */
/* DATA */
/* ============================================================== */
let bills = [];
let currentNums = [];   /* pill ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡πÇ‡∏´‡∏°‡∏î */

let mode = "2d";        /* default */

let buffer = "";
let lastDigits = "";
let isPaste = false;

/* ROOD BUFFER */
let roodBuffer = "";    /* ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏•‡∏Ç‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡πÇ‡∏´‡∏°‡∏î‡∏£‡∏π‡∏î */

/* DOM */
const inputMain = document.getElementById("inputMain");
const inputRun  = document.getElementById("inputRun");
const inputRood = document.getElementById("inputRood");

const numbersContainer = document.getElementById("numbersContainer");
const topPrice   = document.getElementById("top");
const bottomPrice= document.getElementById("bottom");

const pad2 = n => n.toString().padStart(2,"0");
const pad3 = n => n.toString().padStart(3,"0");

/* ============================================================== */
/* UI SWITCH */
/* ============================================================== */
function switchMode(m){
    mode = m;

    document.querySelectorAll(".mode-btn").forEach(x=>x.classList.remove("active"));
    document.getElementById("btn2d").classList.toggle("active", m==="2d");
    document.getElementById("btn3d").classList.toggle("active", m==="3d");
    document.getElementById("btn19").classList.toggle("active", m==="19");
    document.getElementById("btnRun").classList.toggle("active", m==="run");

    document.getElementById("zoneMain").style.display = (m==="2d"||m==="3d") ? "block":"none";
    document.getElementById("zoneRood").style.display = m==="19" ? "block":"none";
    document.getElementById("zoneRun").style.display  = m==="run" ? "block":"none";

    if(m==="2d"||m==="3d"){
        inputMain.value="";
        inputMain.focus();
    }
    if(m==="19"){
        inputRood.value="";
        roodBuffer="";
        inputRood.focus();
    }
    if(m==="run"){
        inputRun.value="";
        inputRun.focus();
    }

    buffer="";
    lastDigits="";
}

/* ============================================================== */
/* RENDER PILL */
/* ============================================================== */
function renderNumbers(){
    numbersContainer.innerHTML="";
    currentNums.forEach((obj, idx)=>{
        let b=document.createElement("button");
        b.className = obj.error ? "num-pill error":"num-pill";
        b.textContent = obj.val;
        b.onclick = ()=>{
            currentNums.splice(idx,1);
            renderNumbers();
        };
        numbersContainer.appendChild(b);
    });
}

/* ============================================================== */
/* MAIN INPUT (2D / 3D) ‚Äî ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏° ‡πÑ‡∏°‡πà‡πÅ‡∏ï‡∏∞‡πÄ‡∏•‡∏¢ */
/* ============================================================== */
inputMain.addEventListener("paste", ()=> isPaste=true);

inputMain.addEventListener("input",(e)=>{
    if(mode!=="2d" && mode!=="3d") return;

    let v = e.target.value;
    let digits = v.replace(/\D/g,"");

    if(isPaste){
        handlePaste(v);
        isPaste=false;
        setTimeout(()=> inputMain.value="",200);
        lastDigits="";
        buffer="";
        return;
    }

    if(digits.length < lastDigits.length){
        buffer="";
        lastDigits=digits;
        return;
    }

    let newDigit = digits.slice(lastDigits.length);
    lastDigits = digits;
    buffer += newDigit;

    if(mode==="2d"){
        while(buffer.length>=2){
            currentNums.push({val:pad2(buffer.slice(0,2)), error:false});
            buffer=buffer.slice(2);
            inputMain.value="";
            buffer="";
            lastDigits="";
        }
    }

    if(mode==="3d"){
        while(buffer.length>=3){
            currentNums.push({val:pad3(buffer.slice(0,3)), error:false});
            buffer=buffer.slice(3);
            inputMain.value="";
            buffer="";
            lastDigits="";
        }
    }

    renderNumbers();
});

/* ============================================================== */
/* PASTE HANDLER ‚Äî ‡πÇ‡∏´‡∏°‡∏î 2/3 ‡∏ï‡∏±‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô */
/* ============================================================== */
function handlePaste(text){
    if(mode!=="2d" && mode!=="3d") return;

    let clean = text.replace(/[^0-9\s]/g," ");
    let tokens = clean.split(/\s+/).filter(x=>x);

    tokens.forEach(t=>{
        if(mode==="2d"){
            if(t.length===2) currentNums.push({val:pad2(t), error:false});
            else if(t.length===1) currentNums.push({val:t, error:true});
        }
        if(mode==="3d"){
            if(t.length===3) currentNums.push({val:pad3(t), error:false});
            else currentNums.push({val:t, error:true});
        }
    });
    renderNumbers();
}

/* ============================================================== */
/* RUN MODE ‚Äî ‡∏û‡∏¥‡∏°‡∏û‡πå 1 ‡∏ï‡∏±‡∏ß ‚Üí pill ‚Üí clear */
/* ============================================================== */
inputRun.addEventListener("paste", e=> e.preventDefault());

inputRun.addEventListener("input",(e)=>{
    if(mode!=="run") return;

    let v = e.target.value.replace(/\D/g,"");
    if(v.length===0) return;

    let d = v[0];
    currentNums.push({val:d, error:false});

    inputRun.value="";
    renderNumbers();
});

/* ============================================================== */
/* ROOD MODE ‚Äî ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß ‚Üí buffer ‚Üí 19 ‡∏õ‡∏£‡∏∞‡∏ï‡∏π */
/* ============================================================== */
inputRood.addEventListener("paste", e=> e.preventDefault());

inputRood.addEventListener("input",(e)=>{
    if(mode!=="19") return;

    let v = e.target.value.replace(/\D/g,"");
    if(v.length===0) return;

    let d = v[0];            /* ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏Å */
    roodBuffer += d;         /* ‡∏™‡∏∞‡∏™‡∏° string */

    /* generate 19 ‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏Ç‡∏≠‡∏á roodBuffer */
    let base = roodBuffer;
    let arr = [];

    /* ‡∏£‡∏π‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤ */
    for(let i=0;i<=9;i++){
        arr.push(pad2(i + base));
    }
    /* ‡∏£‡∏π‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á */
    for(let i=0;i<=9;i++){
        arr.push(pad2(base + i));
    }

    /* push ‡πÄ‡∏•‡∏Ç‡∏•‡∏á pill */
    arr.forEach(n=>{
        if(!currentNums.some(x=>x.val===n)){
            currentNums.push({val:n, error:false});
        }
    });

    inputRood.value="";
    renderNumbers();
});

/* ============================================================== */
/* REVERSE ‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏•‡∏Ç */
/* ============================================================== */
function reverseNumbers(){
    let add=[];

    currentNums.forEach(obj=>{
        if(obj.error) return;

        if(obj.val.length===2){
            let a=obj.val[0], b=obj.val[1];
            if(a!==b){
                let r=pad2(b+a);
                if(!currentNums.some(o=>o.val===r))
                    add.push({val:r,error:false});
            }
        }

        if(obj.val.length===3){
            let [a,b,c]=obj.val.split("");
            let arr=[
                a+b+c,a+c+b,
                b+a+c,b+c+a,
                c+a+b,c+b+a
            ];
            [...new Set(arr)].forEach(x=>{
                if(!currentNums.some(o=>o.val===x))
                    add.push({val:x,error:false});
            });
        }
    });

    currentNums=currentNums.concat(add);
    renderNumbers();
}

/* ============================================================== */
/* CLEAR */
/* ============================================================== */
function clearNumbers(){
    currentNums=[];
    buffer="";
    lastDigits="";
    roodBuffer="";
    renderNumbers();
}

function clearNumbersAndBills(){
    clearNumbers();
    bills=[];
    renderBills();
}

/* ============================================================== */
/* ADD BILL */
/* ============================================================== */
function addBill(){
    let valid = currentNums.filter(o=>!o.error).map(o=>o.val);
    if(valid.length===0) return false;

    let t = Number(topPrice.value||0);
    let b = Number(bottomPrice.value||0);

    bills.push({
        nums:valid,
        top:t,
        bottom:b,
        total:valid.length*(t+b),
        mode:mode
    });

    renderBills();
    return true;
}

function addBillAndReset(){
    if(!addBill()) return;

    clearNumbers();
    inputMain.value="";
    inputRun.value="";
    inputRood.value="";
    topPrice.value="";
    bottomPrice.value="";

    if(mode==="2d"||mode==="3d") inputMain.focus();
    if(mode==="run") inputRun.focus();
    if(mode==="19") inputRood.focus();
}

/* ============================================================== */
/* DELETE BILL */
/* ============================================================== */
function delBill(i){
    bills.splice(i,1);
    renderBills();
}

/* ============================================================== */
/* RENDER BILLS */
/* ============================================================== */
function renderBills(){
    let html="";
    let total=0;

    const billBox = document.getElementById("billList");
    const maxWidth = Math.max((billBox.clientWidth||0)-40,100);

    bills.forEach((b,i)=>{
        total+=b.total;

        const w = (b.mode==="3d") ? maxWidth : maxWidth*0.7;

        const lines = groupByWidth(b.nums, w)
            .map(l=>`<div class="bill-line">${l}</div>`)
            .join("");

        html+=`
        <div class="bill">
            <div class="bill-left">
                <div class="bill-title">${b.mode==="3d"?"3 ‡∏ï‡∏±‡∏ß":(b.mode==="19"?"‡∏£‡∏π‡∏î":"2 ‡∏ï‡∏±‡∏ß")}</div>
                <div class="bill-price">${b.mode==="3d"?"‡∏ö‡∏ô √ó ‡∏•‡πà‡∏≤‡∏á √ó ‡πÇ‡∏ï‡πä‡∏î":"‡∏ö‡∏ô √ó ‡∏•‡πà‡∏≤‡∏á"}</div>
                <div class="bill-multiply">${b.top} √ó ${b.bottom}</div>
                <div class="bill-nums">${lines}</div>
                <div class="bill-total">‡∏£‡∏ß‡∏°‡∏ö‡∏¥‡∏•: ${b.total} ‡∏ö‡∏≤‡∏ó</div>
            </div>
            <div class="del-btn" onclick="delBill(${i})">üóë</div>
        </div>`;
    });

    document.getElementById("billList").innerHTML = html;
    document.getElementById("totalAll").innerText = `‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total} ‡∏ö‡∏≤‡∏ó`;
}

/* MEASURE TEXT FOR BILLS */
const _measureCanvas = document.createElement("canvas");
const _measureCtx=_measureCanvas.getContext("2d");
_measureCtx.font="15px 'Sarabun', sans-serif";

function groupByWidth(nums, maxWidth){
    const lines=[];
    let current="";
    let width=0;

    nums.forEach(n=>{
        const token=(current?" ":"")+n;
        const w=_measureCtx.measureText(token).width;

        if(current && width + w > maxWidth){
            lines.push(current);
            current=n;
            width=_measureCtx.measureText(n).width;
        } else {
            current+=(current?" ":"")+n;
            width+=w;
        }
    });

    if(current) lines.push(current);
    return lines;
}

</script>

</body>
</html>
