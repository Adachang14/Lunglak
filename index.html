<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>หวย Simulator</title>

<style>
    body {
        background:#f7d3f2;
        font-family:'Sarabun', sans-serif;
        padding:20px;
    }
    .box {
        width:100%;
        max-width:500px;
        margin:auto;
        background:#fff;
        padding:20px;
        border-radius:15px;
        box-shadow:0 5px 20px rgba(0,0,0,0.15);
    }
    h2 {
        text-align:center;
        color:#c449d5;
        margin-bottom:20px;
    }
    textarea, input[type="text"] {
        width:100%;
        padding:12px;
        border-radius:10px;
        border:1px solid #aaa;
        font-size:16px;
        box-sizing:border-box;
    }
    #numbersDisplay {
        height:90px;
        resize:none;
        background:#fffafc;
    }
    .row { display:flex; gap:10px; margin:10px 0; }

    input[type="number"] {
        width:100%;
        padding:12px;
        border-radius:10px;
        border:1px solid #ccc;
        font-size:16px;
        box-sizing:border-box;
    }

    button {
        padding:12px 16px;
        font-size:16px;
        border-radius:10px;
        border:none;
        cursor:pointer;
        font-weight:bold;
    }
    button:focus { outline: none !important; }

    .btn-rev  { background:#ffe06c; }
    .btn-clear{ background:#ffb3c1; }
    .btn-add  { background:#ff44c7; color:white; }

    .bill-box {
        margin-top:20px;
        background:#ffe7f8;
        padding:15px;
        border-radius:15px;
    }
    .bill {
        background:white;
        padding:12px;
        border-radius:12px;
        margin-bottom:12px;
        font-size:17px;
        display:flex;
        justify-content:space-between;
    }
    .del-btn {
        color:red;
        font-size:22px;
        cursor:pointer;
    }
    .total-all {
        text-align:center;
        font-size:22px;
        margin-top:20px;
        font-weight:bold;
    }

    .label {
        font-size:14px;
        margin:5px 0 3px;
        color:#555;
    }
</style>
</head>

<body>

<div class="box">

    <h2>หวย Simulator Demo</h2>

    <!-- ช่อง 1 -->
    <div class="label">ช่อง 1: พิมพ์หรือกอปเลข (ครบ 2 หลักจะเด้งไปช่อง 2 อัตโนมัติ)</div>
    <input id="inputNums" type="text" placeholder="เช่น 12 25 หรือ 30343710141713=20*20กลับบนลาว">

    <!-- ช่อง 2 -->
    <div class="label">ช่อง 2: ผลลัพธ์เลขล้วน (ใช้กลับเลข + คำนวณ)</div>
    <textarea id="numbersDisplay" readonly placeholder="เลขจะมาแสดงที่นี่ เช่น 12 25 30 34"></textarea>

    <div class="row">
        <button class="btn-rev" onclick="reverseNumbers()">กลับเลข</button>
        <button class="btn-clear" onclick="clearNumbers()">ล้างเลข</button>
    </div>

    <div class="row">
        <input id="top" type="number" placeholder="ราคา บน">
        <input id="bottom" type="number" placeholder="ราคา ล่าง">
    </div>

    <button id="btnAdd" class="btn-add" onclick="addBillAndReset()">+ เพิ่มบิล</button>

    <div class="bill-box" id="billList"></div>

    <div id="totalAll" class="total-all">รวมทั้งหมด: 0 บาท</div>

</div>


<script>
let bills = [];
let tabCount = 0;

// ดึงเฉพาะเลข 2 หลักจากข้อความ
function extractNumbers(text) {
    return text.match(/\b\d{2}\b/g) || [];
}

const inputNums      = document.getElementById("inputNums");
const numbersDisplay = document.getElementById("numbersDisplay");
const topPrice       = document.getElementById("top");
const bottomPrice    = document.getElementById("bottom");

/* ==== ช่อง 1: ทุกครั้งที่พิมพ์ / วาง ให้จับทีละ 2 หลักแล้วโยนลงช่อง 2 ==== */
inputNums.addEventListener("input", function () {
    let raw = this.value;

    // เอาเฉพาะส่วนก่อน "=" (กัน 20*20 ด้านหลัง)
    let mainPart = raw.split("=")[0];

    // เอาแต่ตัวเลข
    let digits = mainPart.replace(/\D/g, "");

    let newNums = [];
    while (digits.length >= 2) {
        newNums.push(digits.slice(0, 2));
        digits = digits.slice(2);
    }

    if (newNums.length > 0) {
        const existing = extractNumbers(numbersDisplay.value);
        numbersDisplay.value = existing.concat(newNums).join(" ");
    }

    // เหลือไว้แค่เศษตัวเลขที่ยังไม่ครบ 2 หลัก
    this.value = digits;
});

/* ==== กลับเลขในช่อง 2 ==== */
function reverseNumbers() {
    const raw  = numbersDisplay.value;
    const nums = extractNumbers(raw);

    if (nums.length === 0) {
        alert("ไม่มีเลขให้กลับ");
        return;
    }

    const reversed = [];
    nums.forEach(num => {
        if (num.length === 2) {
            reversed.push(num[1] + num[0]);
        }
    });

    numbersDisplay.value = nums.join(" ") + " " + reversed.join(" ");
}

/* ==== ล้างเลขในช่อง 2 ==== */
function clearNumbers() {
    numbersDisplay.value = "";
}

/* ==== เพิ่มบิล (core) ==== */
function addBill() {
    const nums = extractNumbers(numbersDisplay.value);

    if (nums.length === 0) {
        alert("ยังไม่มีเลขในช่อง 2");
        return false;
    }

    const t = Number(topPrice.value || 0);
    const b = Number(bottomPrice.value || 0);

    const count      = nums.length;
    const sumTop     = count * t;
    const sumBottom  = count * b;
    const sumBill    = sumTop + sumBottom;

    bills.push({
        nums,
        top: t,
        bottom: b,
        total: sumBill
    });

    renderBills();
    return true;
}

/* ==== เพิ่มบิล + ล้างค่าพร้อมลงใหม่ ==== */
function addBillAndReset() {
    if (!addBill()) return;

    // ล้างเลข + ราคา + ช่อง 1
    numbersDisplay.value = "";
    topPrice.value = "";
    bottomPrice.value = "";
    inputNums.value = "";
    tabCount = 0;
    inputNums.focus();
}

/* ==== ลบบิล ==== */
function delBill(i) {
    bills.splice(i, 1);
    renderBills();
}

/* ==== แสดงบิล ==== */
function renderBills() {
    let html     = "";
    let totalAll = 0;

    bills.forEach((b, i) => {
        totalAll += b.total;

        html += `
            <div class="bill">
                <div>
                    ${b.nums.join(" ")}<br>
                    บน ${b.top} × ${b.nums.length} = ${b.top * b.nums.length}<br>
                    ล่าง ${b.bottom} × ${b.nums.length} = ${b.bottom * b.nums.length}<br>
                    <b>รวมบิล: ${b.total} บาท</b>
                </div>
                <div class="del-btn" onclick="delBill(${i})">×</div>
            </div>
        `;
    });

    document.getElementById("billList").innerHTML = html;
    document.getElementById("totalAll").innerText =
        `รวมทั้งหมด: ${totalAll} บาท`;
}

/* ==== Tab: วิ่งเฉพาะ บน -> ล่าง -> เพิ่มบิล ==== */
document.addEventListener("keydown", function(e){
    if (e.key !== "Tab") return;

    e.preventDefault();

    const active = document.activeElement;

    if (active === topPrice) {
        bottomPrice.focus();
        tabCount = 2;
    } else if (active === bottomPrice) {
        tabCount = 3;
        addBillAndReset();
    } else {
        topPrice.focus();
        tabCount = 1;
    }
});

/* ==== สเปซบาร์ = กลับเลข "ทุกที่บนหน้านี้" ==== */
document.addEventListener("keydown", function(e){
    if (e.code === "Space" || e.key === " ") {
        e.preventDefault();   // กันไม่ให้พิมพ์ช่องว่างทุกที่
        reverseNumbers();     // กลับเลขทันที
    }
});
</script>

</body>
</html>
